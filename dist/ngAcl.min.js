"use strict";!function(e){e.run(function(e,t,i,r){e.$on("$stateChangeStart",function(n,s,o,l,a){return s&&s.data&&s.data.resource?r.initialized?r.isAllowed(s.data.resource)?void 0:(n.preventDefault(),void e.$emit("acl.stateChangeDenied",{event:n,toState:s,toParams:o,fromState:l,fromParams:a})):(n.preventDefault(),void i(function(){t.go(s,o)},50)):void 0})})}(angular.module("ngAcl",["ngAcl.services","ngAcl.directives"])),function(e){e.directive("rr",["acl","$rootScope",function(e,t){var i={};return t.$on("acl.change",function(t,r){for(var n in i)for(var s=e.isAllowed(n),o=0;o<i[n].length;o++)s?i[n][o].placeholder.parentNode.insertBefore(i[n][o].element[0],i[n][o].placeholder):i[n][o].element.detach()}),{restrict:"A",terminal:!0,link:function(t,r,n){"undefined"==typeof i[n.rr]&&(i[n.rr]=[]);var s=document.createComment("rr="+n.rr);r[0].parentNode.insertBefore(s,r[0]),r.detach(),i[n.rr].push({element:r,placeholder:s}),e.initialized&&e.isAllowed(n.rr)&&s.parentNode.insertBefore(r[0],s)}}}])}(angular.module("ngAcl.directives",["ngAcl.services"])),function(e){var t=",",i="|";e.service("acl",["$rootScope",function(e){this.initialized=!1,this.identity={},this.init=function(t){if(this.initialized=!0,this.rulesCache={},this.identity=t,this.identity.resources||(this.identity.resources={allowed:[],denied:[]}),!this.identity.resources.allowed||!this.identity.resources.allowed)throw new Error("resources must be an object with allowed and denied properties");e.$emit("acl.change",t)},this.testRule=function(e,t){if(e===t)return!0;var i,r;i="undefined"!=typeof this.rulesCache[e]?this.rulesCache[e]:this.rulesCache[e]=e.split("."),r="undefined"!=typeof this.rulesCache[t]?this.rulesCache[t]:this.rulesCache[t]=t.split(".");for(var n=!1,s=0;s<r.length;s++){if("undefined"==typeof i[s]){n="**"===i[i.length-1];break}if(i[s]!==r[s]&&"*"!==i[s]&&"**"!=i[s]){n=!1;break}n=!0}return n},this.isAllowed=function(e){var r,n=!1,s=!0;-1!==e.indexOf(t)?(r=e.split(t),s=!1):r=e.split(i);for(var o=0;o<r.length&&(n=this.$isAllowed(r[o]),!s||!n);o++);return n},this.$isAllowed=function(e){var t=!1;"!"===e.charAt(0)&&(t=!0,e=e.substring(1));var i=!1;if("loggedin"==e)i=this.identity&&this.identity.isGuest===!1;else{for(var r=0;r<this.identity.resources.allowed.length&&!(i=this.testRule(this.identity.resources.allowed[r],e));r++);if(i)for(r=0;r<this.identity.resources.denied.length&&(i=!this.testRule(this.identity.resources.denied[r],e),i);r++);}return t?!i:i}}])}(angular.module("ngAcl.services",[]));